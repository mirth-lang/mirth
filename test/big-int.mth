module test.big-int

import std.prelude
import std.test

def main {
    +Tests.Start!

    "literals" test (
        -0x8000_0000_0000_0000 >Str =>: "-9223372036854775808"
        0x7FFF_FFFF_FFFF_FFFF >Str =>: "9223372036854775807"

        I64.Min >Int >Str =>: "-9223372036854775808"
        I64.Max >Int >Str =>: "9223372036854775807"

        U64.Min >Int >Str =>: "0"
        U64.Max >Int >Str =>: "18446744073709551615"

        0x1_00000000_00000000 >Str =>: "0x00000001_00000000_00000000"
        0x12345678_12345678_12345678 >Str =>: "0x12345678_12345678_12345678"

        -0x01_00000000_00000000 >Str =>: "-0x00000001_00000000_00000000"
        -0x10_00000000_00000000 >Str =>: "-0x00000010_00000000_00000000"
        -0x1_00000000_00000000_00000000 >Str =>: "-0x00000001_00000000_00000000_00000000"

        0xFFFFFFFF_FFFFFFFF >Str =>: "18446744073709551615"
        0xFFFFFFFF_FFFFFFFF_FFFFFFFF >Str =>: "0xFFFFFFFF_FFFFFFFF_FFFFFFFF"
        0xFFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF >Str =>: "0xFFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF"
    )

    "addition" test (
        10 10 + =>: 20
        I64.Max >Int 1 + >Str =>: "9223372036854775808"
        I64.Max >Int dup + >Str =>: "18446744073709551614"
        I64.Max >Int dup + 1+ >Str =>: "18446744073709551615"
        I64.Max >Int dup + 1+ 1+ >Str =>: "0x00000001_00000000_00000000"
        I64.Min >Int dup + >Str =>: "-0x00000001_00000000_00000000"
        U64.Max >Int >Str =>: "18446744073709551615"
        U64.Max >Int 1+ >Str =>: "0x00000001_00000000_00000000"
    )

    "addition" test (
        10 10 + =>: 20
        I64.Max >Int 1 + >Str =>: "9223372036854775808"
        I64.Max >Int dup + >Str =>: "18446744073709551614"
        I64.Max >Int dup + 1+ >Str =>: "18446744073709551615"
        I64.Max >Int dup + 1+ 1+ >Str =>: "0x00000001_00000000_00000000"
        I64.Min >Int dup + >Str =>: "-0x00000001_00000000_00000000"
        U64.Max >Int >Str =>: "18446744073709551615"
        U64.Max >Int 1+ >Str =>: "0x00000001_00000000_00000000"
    )

    "subtraction" test (
        10 10 - =>: 0
        I64.Max >Int 1+ 1- >Str =>: "9223372036854775807"
        I64.Max >Int 1- 1+ >Str =>: "9223372036854775807"
        I64.Min >Int 1+ 1- >Str =>: "-9223372036854775808"
        I64.Min >Int 1- 1+ >Str =>: "-9223372036854775808"

        U64.Max >Int dup - >Str =>: "0"
        U64.Max >Int 1- >Str =>: "18446744073709551614"
        U64.Max >Int 1+ 1- >Str =>: "18446744073709551615"
        U64.Max >Int 1- 1+ >Str =>: "18446744073709551615"
        U64.Max >Int -1 - >Str =>: "0x00000001_00000000_00000000"
    )

    "multiplication" test (
        U64.Max >Int 2* >Str =>: "0x00000001_FFFFFFFF_FFFFFFFE"
        U64.Max >Int 16 * >Str =>: "0x0000000F_FFFFFFFF_FFFFFFF0"
        U64.Max >Int dup * >Str =>: "0xFFFFFFFF_FFFFFFFE_00000000_00000001"
        I64.Min >Int 2* >Str =>: "-0x00000001_00000000_00000000"
        I64.Min >Int dup * >Str =>: "0x40000000_00000000_00000000_00000000"
        I64.Min >Int 2* dup * >Str =>: "0x00000001_00000000_00000000_00000000_00000000"
        I64.Min >Int 2* dup * U64.Max >Int * >Str =>: "0xFFFFFFFF_FFFFFFFF_00000000_00000000_00000000_00000000"
        0x1_0000_0000 dup * >Str =>: "0x00000001_00000000_00000000"
    )

    "division" test (
        100  3 divmod =>:  1 =>:  33    -100 -3 divmod =>: -1 =>:  33
        101  3 divmod =>:  2 =>:  33    -101 -3 divmod =>: -2 =>:  33
        102  3 divmod =>:  0 =>:  34    -102 -3 divmod =>: -0 =>:  34
        103  3 divmod =>:  1 =>:  34    -103 -3 divmod =>: -1 =>:  34
        104  3 divmod =>:  2 =>:  34    -104 -3 divmod =>: -2 =>:  34
        105  3 divmod =>:  0 =>:  35    -105 -3 divmod =>: -0 =>:  35
        106  3 divmod =>:  1 =>:  35    -106 -3 divmod =>: -1 =>:  35

        100 -3 divmod =>: -2 =>: -34    -100  3 divmod =>:  2 =>: -34
        101 -3 divmod =>: -1 =>: -34    -101  3 divmod =>:  1 =>: -34
        102 -3 divmod =>: -0 =>: -34    -102  3 divmod =>:  0 =>: -34
        103 -3 divmod =>: -2 =>: -35    -103  3 divmod =>:  2 =>: -35
        104 -3 divmod =>: -1 =>: -35    -104  3 divmod =>:  1 =>: -35
        105 -3 divmod =>: -0 =>: -35    -105  3 divmod =>:  0 =>: -35
        106 -3 divmod =>: -2 =>: -36    -106  3 divmod =>:  2 =>: -36

        0x10000000_10000000_10000000 0x10      divmod =>: 0 >Str =>: "0x01000000_01000000_01000000"
        0x01000000_01000000_01000000 0x100     divmod =>: 0 >Str =>: "0x00010000_00010000_00010000"
        0x00010000_00010000_00010000 0x10000   divmod =>: 0 >Str =>: "0x00000001_00000001_00000001"
        0x00000001_00000001_00000001 0x1000000 divmod =>: 1      =>:           0x00000100_00000100

        0x10000000_00000000_00000000 0x4_00000000_00000000 divmod =>: 0x0_00000000_00000000 =>: 0x4000000
        0x10000001_00000000_00000000 0x4_00000000_00000000 divmod =>: 0x1_00000000_00000000 =>: 0x4000000
        0x10000002_00011000_00001100 0x4_00000000_00000000 divmod =>: 0x2_00011000_00001100 =>: 0x4000000
        0x10000003_00011000_00001100 0x4_00000000_00000000 divmod =>: 0x3_00011000_00001100 =>: 0x4000000
        0x10000004_00000000_00000000 0x4_00000000_00000000 divmod =>: 0x0_00000000_00000000 =>: 0x4000001
        0x10000005_00000000_00000000 0x4_00000000_00000000 divmod =>: 0x1_00000000_00000000 =>: 0x4000001
        0x10000006_00001000_00001000 0x4_00000000_00000000 divmod =>: 0x2_00001000_00001000 =>: 0x4000001
        0x10000007_00000111_11110000 0x4_00000000_00000000 divmod =>: 0x3_00000111_11110000 =>: 0x4000001
        0x10000008_00000000_00000000 0x4_00000000_00000000 divmod =>: 0x0_00000000_00000000 =>: 0x4000002
        0x10000009_00000000_00000000 0x4_00000000_00000000 divmod =>: 0x1_00000000_00000000 =>: 0x4000002
        0x1000000A_00000000_00000000 0x4_00000000_00000000 divmod =>: 0x2_00000000_00000000 =>: 0x4000002

        -0x10000000_00000000_00000000 -0x4_00000000_00000000 divmod =>: -0x0_00000000_00000000 =>: 0x4000000
        -0x10000001_00000000_00000000 -0x4_00000000_00000000 divmod =>: -0x1_00000000_00000000 =>: 0x4000000
        -0x10000002_00011000_00001100 -0x4_00000000_00000000 divmod =>: -0x2_00011000_00001100 =>: 0x4000000
        -0x10000003_00011000_00001100 -0x4_00000000_00000000 divmod =>: -0x3_00011000_00001100 =>: 0x4000000
        -0x10000004_00000000_00000000 -0x4_00000000_00000000 divmod =>: -0x0_00000000_00000000 =>: 0x4000001
        -0x10000005_00000000_00000000 -0x4_00000000_00000000 divmod =>: -0x1_00000000_00000000 =>: 0x4000001
        -0x10000006_00001000_00001000 -0x4_00000000_00000000 divmod =>: -0x2_00001000_00001000 =>: 0x4000001
        -0x10000007_00000111_11110000 -0x4_00000000_00000000 divmod =>: -0x3_00000111_11110000 =>: 0x4000001
        -0x10000008_00000000_00000000 -0x4_00000000_00000000 divmod =>: -0x0_00000000_00000000 =>: 0x4000002
        -0x10000009_00000000_00000000 -0x4_00000000_00000000 divmod =>: -0x1_00000000_00000000 =>: 0x4000002
        -0x1000000A_00000000_00000000 -0x4_00000000_00000000 divmod =>: -0x2_00000000_00000000 =>: 0x4000002

        -0x10000000_00000000_00000000 0x4_00000000_00000000 divmod =>: 0x0_00000000_00000000 =>: -0x4000000
        -0x10000001_00000000_00000000 0x4_00000000_00000000 divmod =>: 0x3_00000000_00000000 =>: -0x4000001
        -0x10000002_00000000_00000000 0x4_00000000_00000000 divmod =>: 0x2_00000000_00000000 =>: -0x4000001
        -0x10000003_00000000_00000000 0x4_00000000_00000000 divmod =>: 0x1_00000000_00000000 =>: -0x4000001
        -0x10000004_00000000_00000000 0x4_00000000_00000000 divmod =>: 0x0_00000000_00000000 =>: -0x4000001
        -0x10000005_00000000_00000000 0x4_00000000_00000000 divmod =>: 0x3_00000000_00000000 =>: -0x4000002
        -0x10000006_00000000_00000000 0x4_00000000_00000000 divmod =>: 0x2_00000000_00000000 =>: -0x4000002
        -0x10000007_00000000_00000000 0x4_00000000_00000000 divmod =>: 0x1_00000000_00000000 =>: -0x4000002
        -0x10000008_00000000_00000000 0x4_00000000_00000000 divmod =>: 0x0_00000000_00000000 =>: -0x4000002
        -0x10000009_00000000_00000000 0x4_00000000_00000000 divmod =>: 0x3_00000000_00000000 =>: -0x4000003
        -0x1000000A_00000000_00000000 0x4_00000000_00000000 divmod =>: 0x2_00000000_00000000 =>: -0x4000003

        0x10000000_00000000_00000000 -0x4_00000000_00000000 divmod =>: -0x0_00000000_00000000 =>: -0x4000000
        0x10000001_00000000_00000000 -0x4_00000000_00000000 divmod =>: -0x3_00000000_00000000 =>: -0x4000001
        0x10000002_00000000_00000000 -0x4_00000000_00000000 divmod =>: -0x2_00000000_00000000 =>: -0x4000001
        0x10000003_00000000_00000000 -0x4_00000000_00000000 divmod =>: -0x1_00000000_00000000 =>: -0x4000001
        0x10000004_00000000_00000000 -0x4_00000000_00000000 divmod =>: -0x0_00000000_00000000 =>: -0x4000001
        0x10000005_00000000_00000000 -0x4_00000000_00000000 divmod =>: -0x3_00000000_00000000 =>: -0x4000002
        0x10000006_00000000_00000000 -0x4_00000000_00000000 divmod =>: -0x2_00000000_00000000 =>: -0x4000002
        0x10000007_00000000_00000000 -0x4_00000000_00000000 divmod =>: -0x1_00000000_00000000 =>: -0x4000002
        0x10000008_00000000_00000000 -0x4_00000000_00000000 divmod =>: -0x0_00000000_00000000 =>: -0x4000002
        0x10000009_00000000_00000000 -0x4_00000000_00000000 divmod =>: -0x3_00000000_00000000 =>: -0x4000003
        0x1000000A_00000000_00000000 -0x4_00000000_00000000 divmod =>: -0x2_00000000_00000000 =>: -0x4000003
    )

    "long division" test (
        0x00000000_10000000_10000000 0x10000000_10000000 divmod =>: 0x0_00000000_00000000 =>: 0x00000001
        0x00000100_00000100_00000000 0x10000000_10000000 divmod =>: 0x00000000_00000000 =>: 0x00001000
        0x00000100_10000100_00000000 0x10000000_10000000 divmod =>: 0x10000000_00000000 =>: 0x00001000
        0x00000100_10000100_0FFFFFFF 0x10000000_10000000 divmod =>: 0x10000000_0FFFFFFF =>: 0x00001000
        0x00000100_10000100_10000000 0x10000000_10000000 divmod =>: 0x00000000_00000000 =>: 0x00001001

        0x00000001_00000001_00000000 0x00000001_00000001_00000000 divmod =>: 0x0_00000000_00000000 =>: 1
        0x00000001_00000001_00000001 0x00000001_00000001_00000000 divmod =>: 0x0_00000000_00000001 =>: 1
        0x00000001_F0000001_00000000 0x00000001_00000001_00000000 divmod =>: 0x0_F0000000_00000000 =>: 1
        0x00000001_FFFFFFFF_FFFFFFFF 0x00000001_00000001_00000000 divmod =>: 0x0_FFFFFFFE_FFFFFFFF =>: 1
        0x00000002_00000000_00000000 0x00000001_00000001_00000000 divmod =>: 0x0_FFFFFFFF_00000000 =>: 1
        0x00000002_00000000_FFFFFFFF 0x00000001_00000001_00000000 divmod =>: 0x0_FFFFFFFF_FFFFFFFF =>: 1
        0x00000002_00000001_00000000 0x00000001_00000001_00000000 divmod =>: 0x1_00000000_00000000 =>: 1
        0x00000002_00000001_FFFFFFFF 0x00000001_00000001_00000000 divmod =>: 0x1_00000000_FFFFFFFF =>: 1
        0x00000002_00000002_00000000 0x00000001_00000001_00000000 divmod =>: 0x0_00000000_00000000 =>: 2
        0x00000002_00000002_FFFFFFFF 0x00000001_00000001_00000000 divmod =>: 0x0_00000000_FFFFFFFF =>: 2
        0x00000002_00000003_00000000 0x00000001_00000001_00000000 divmod =>: 0x0_00000001_00000000 =>: 2
        0x00000002_FFFFFFFF_FFFFFFFF 0x00000001_00000001_00000000 divmod =>: 0x0_FFFFFFFD_FFFFFFFF =>: 2
        0x00000003_00000000_00000000 0x00000001_00000001_00000000 divmod =>: 0x0_FFFFFFFE_00000000 =>: 2
        0x00000003_00000000_FFFFFFFF 0x00000001_00000001_00000000 divmod =>: 0x0_FFFFFFFE_FFFFFFFF =>: 2
        0x00000003_00000001_00000000 0x00000001_00000001_00000000 divmod =>: 0x0_FFFFFFFF_00000000 =>: 2
        0x00000003_00000001_FFFFFFFF 0x00000001_00000001_00000000 divmod =>: 0x0_FFFFFFFF_FFFFFFFF =>: 2
        0x00000003_00000002_00000000 0x00000001_00000001_00000000 divmod =>: 0x1_00000000_00000000 =>: 2
        0x00000003_00000002_FFFFFFFF 0x00000001_00000001_00000000 divmod =>: 0x1_00000000_FFFFFFFF =>: 2
        0x00000003_00000003_00000000 0x00000001_00000001_00000000 divmod =>: 0x0_00000000_00000000 =>: 3

        -0x00000001_00000001_00000000 -0x00000001_00000001_00000000 divmod =>: -0x0_00000000_00000000 =>: 1
        -0x00000001_00000001_00000001 -0x00000001_00000001_00000000 divmod =>: -0x0_00000000_00000001 =>: 1
        -0x00000001_F0000001_00000000 -0x00000001_00000001_00000000 divmod =>: -0x0_F0000000_00000000 =>: 1
        -0x00000001_FFFFFFFF_FFFFFFFF -0x00000001_00000001_00000000 divmod =>: -0x0_FFFFFFFE_FFFFFFFF =>: 1
        -0x00000002_00000000_00000000 -0x00000001_00000001_00000000 divmod =>: -0x0_FFFFFFFF_00000000 =>: 1
        -0x00000002_00000000_FFFFFFFF -0x00000001_00000001_00000000 divmod =>: -0x0_FFFFFFFF_FFFFFFFF =>: 1
        -0x00000002_00000001_00000000 -0x00000001_00000001_00000000 divmod =>: -0x1_00000000_00000000 =>: 1
        -0x00000002_00000001_FFFFFFFF -0x00000001_00000001_00000000 divmod =>: -0x1_00000000_FFFFFFFF =>: 1
        -0x00000002_00000002_00000000 -0x00000001_00000001_00000000 divmod =>: -0x0_00000000_00000000 =>: 2
        -0x00000002_00000002_FFFFFFFF -0x00000001_00000001_00000000 divmod =>: -0x0_00000000_FFFFFFFF =>: 2
        -0x00000002_00000003_00000000 -0x00000001_00000001_00000000 divmod =>: -0x0_00000001_00000000 =>: 2
        -0x00000002_FFFFFFFF_FFFFFFFF -0x00000001_00000001_00000000 divmod =>: -0x0_FFFFFFFD_FFFFFFFF =>: 2
        -0x00000003_00000000_00000000 -0x00000001_00000001_00000000 divmod =>: -0x0_FFFFFFFE_00000000 =>: 2
        -0x00000003_00000000_FFFFFFFF -0x00000001_00000001_00000000 divmod =>: -0x0_FFFFFFFE_FFFFFFFF =>: 2
        -0x00000003_00000001_00000000 -0x00000001_00000001_00000000 divmod =>: -0x0_FFFFFFFF_00000000 =>: 2
        -0x00000003_00000001_FFFFFFFF -0x00000001_00000001_00000000 divmod =>: -0x0_FFFFFFFF_FFFFFFFF =>: 2
        -0x00000003_00000002_00000000 -0x00000001_00000001_00000000 divmod =>: -0x1_00000000_00000000 =>: 2
        -0x00000003_00000002_FFFFFFFF -0x00000001_00000001_00000000 divmod =>: -0x1_00000000_FFFFFFFF =>: 2
        -0x00000003_00000003_00000000 -0x00000001_00000001_00000000 divmod =>: -0x0_00000000_00000000 =>: 3

        -0x00000001_00000001_00000000 0x00000001_00000001_00000000 divmod =>: 0x0_00000000_00000000 =>: -1
        -0x00000001_00000001_00000001 0x00000001_00000001_00000000 divmod =>: 0x1_00000000_FFFFFFFF =>: -2
        -0x00000001_00000002_00000000 0x00000001_00000001_00000000 divmod =>: 0x1_00000000_00000000 =>: -2
        -0x00000001_FFFFFFFF_FFFFFFFF 0x00000001_00000001_00000000 divmod =>: 0x0_00000002_00000001 =>: -2
        -0x00000002_00000000_00000000 0x00000001_00000001_00000000 divmod =>: 0x0_00000002_00000000 =>: -2
        -0x00000002_00000000_00000001 0x00000001_00000001_00000000 divmod =>: 0x0_00000001_FFFFFFFF =>: -2
        -0x00000002_00000000_FFFFFFFF 0x00000001_00000001_00000000 divmod =>: 0x0_00000001_00000001 =>: -2
        -0x00000002_00000001_00000000 0x00000001_00000001_00000000 divmod =>: 0x0_00000001_00000000 =>: -2
        -0x00000002_00000001_FFFFFFFF 0x00000001_00000001_00000000 divmod =>: 0x0_00000000_00000001 =>: -2
        -0x00000002_00000002_00000000 0x00000001_00000001_00000000 divmod =>: 0x0_00000000_00000000 =>: -2
        -0x00000002_00000002_00000001 0x00000001_00000001_00000000 divmod =>: 0x1_00000000_FFFFFFFF =>: -3

        0x00000001_00000001_00000000 -0x00000001_00000001_00000000 divmod =>: -0x0_00000000_00000000 =>: -1
        0x00000001_00000001_00000001 -0x00000001_00000001_00000000 divmod =>: -0x1_00000000_FFFFFFFF =>: -2
        0x00000001_00000002_00000000 -0x00000001_00000001_00000000 divmod =>: -0x1_00000000_00000000 =>: -2
        0x00000001_FFFFFFFF_FFFFFFFF -0x00000001_00000001_00000000 divmod =>: -0x0_00000002_00000001 =>: -2
        0x00000002_00000000_00000000 -0x00000001_00000001_00000000 divmod =>: -0x0_00000002_00000000 =>: -2
        0x00000002_00000000_00000001 -0x00000001_00000001_00000000 divmod =>: -0x0_00000001_FFFFFFFF =>: -2
        0x00000002_00000000_FFFFFFFF -0x00000001_00000001_00000000 divmod =>: -0x0_00000001_00000001 =>: -2
        0x00000002_00000001_00000000 -0x00000001_00000001_00000000 divmod =>: -0x0_00000001_00000000 =>: -2
        0x00000002_00000001_FFFFFFFF -0x00000001_00000001_00000000 divmod =>: -0x0_00000000_00000001 =>: -2
        0x00000002_00000002_00000000 -0x00000001_00000001_00000000 divmod =>: -0x0_00000000_00000000 =>: -2
        0x00000002_00000002_00000001 -0x00000001_00000001_00000000 divmod =>: -0x1_00000000_FFFFFFFF =>: -3

        0x12345678_00000000_12345678_00000000_12345678 0x1_00000001 *
            =>: 0x12345678_12345678_12345678_12345678_12345678_12345678
        0x12345678_12345678_12345678_12345678_12345678_12345678 0x1_0000_0001 divmod =>: 0x0
            =>: 0x12345678_00000000_12345678_00000000_12345678

        0x12345678_00000000_00000000_12345678 0x1_00000001_00000001 *
            =>: 0x12345678_12345678_12345678_12345678_12345678_12345678
        0x12345678_12345678_12345678_12345678_12345678_12345678 0x1_00000001_00000001 divmod =>: 0x0
            =>: 0x12345678_00000000_00000000_12345678

        0x12345678_12345678_12345678 0x1_00000000_00000000_00000001 *
            =>: 0x12345678_12345678_12345678_12345678_12345678_12345678
        0x12345678_12345678_12345678_12345678_12345678_12345678 0x1_00000000_00000000_00000001 divmod =>: 0x0
            =>: 0x12345678_12345678_12345678
    )

    end!
}
# mirth-test # pout # 7 tests passed.
