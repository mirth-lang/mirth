module(mirth.variable)

import(std.prelude)
import(std.lazy)
import(mirth.name)
import(mirth.def)

table(Variable)
field(Variable.~head, Variable, Token)
field(Variable.~qname, Variable, QName)
field(Variable.~type, Variable, Lazy(Type))

def(Variable.head, Variable -- Token, ~head @)
def(Variable.qname, Variable -- QName, ~qname @)
def(Variable.type, Variable -- Type, ~type force!)

def(Variable.new!, Token QName Lazy(Type) -- Variable,
    Variable.alloc!
    tuck ~type !
    tuck ~qname !
    tuck ~head !
    dup DEF_VARIABLE register)
