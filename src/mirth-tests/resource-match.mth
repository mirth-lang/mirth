module(mirth-tests.resource-match)

import(std.prelude)
import(std.either)
import(posix.posix)

data(+Foo,
    FOO! -> Int +World,
    BAR! -> Str +World,
    BAZ! -> +Foo)

def(+Foo.reset!, +Foo -- Either(Int,Str) +World,
    FOO! -> LEFT,
    BAR! -> RIGHT,
    BAZ! -> reset!)

def(my-trace, Either(Int,Str) +World -- +World,
    LEFT -> trace! " LEFT" trace!,
    RIGHT -> trace! " RIGHT" trace!)

def(whatever, Either(Int,Str) +World -- +World,
    _ -> drop "whatever" trace!)

def(main, +World -- +World,
    10 FOO! reset! my-trace line-trace!
    20 FOO! reset! my-trace line-trace!
    "Hello." BAR! reset! my-trace line-trace!
    "World." BAR! BAZ! reset! my-trace line-trace!
    "Foo" BAR! reset! whatever line-trace!)

# mirth-test # perr # 10 LEFT
# mirth-test # perr # 20 LEFT
# mirth-test # perr # Hello. RIGHT
# mirth-test # perr # World. RIGHT
# mirth-test # perr # whatever
